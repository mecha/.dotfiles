#! /bin/env zsh
# Create new project.

full_path=""
project_dir=""
project_name=""

function usage() {
    echo "Usage: new [path]"
    echo "Create a new project."
    echo ""
    echo "Arguments:"
    echo "  [path]  The absolute path of the project to create."
    echo ""
    echo "Options:"
    echo "  --help  Show this message."
}

function prompt_path() {
    project_dir=$(find "$DEV_PATH" -mindepth 1 -maxdepth 1 -type d -printf "%f\n" | fzf --reverse --prompt="Ôêì Location: " --height=5)

    if [[ -z $project_dir ]]; then
        exit 0
    fi

    read -r "project_name?Enter a name: "

    if [[ -z $project_name ]]; then
        echo ""
    else
        echo "$DEV_PATH/$project_dir/$project_name"
    fi
}

function create_project() {
    mkdir -p "$1"
    cd "$1" && git init -q -b main
    tps "$1"
}

function green() {
    echo -e "\033[32m$1\033[0m"
}

# ---

if [[ $1 == "--help" ]]; then
    usage
    exit 0
fi

if [[ $# -eq 1 ]]; then
    create_project "$1"
else
    while true
    do
        fullpath=$(prompt_path)

        if [[ -z "$fullpath" ]]; then
            exit 0
        fi

        read -k 1 -r "confirm?Create project at $(green $fullpath) [y/n/q]"

        if [[ $confirm =~ ^[Yy]$ ]]; then
            create_project "$fullpath"
            exit 0
        elif [[ $confirm =~ ^[Qq]$ ]]; then
            exit 0
        fi
    done
fi
