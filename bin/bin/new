#! /bin/env bash
# New project creation script

PROJECTS_DIR=/mnt/files/dev/projects

function usage() {
    self=$(basename "$0")
    echo "Create a new project."
    echo "  Miguel Muscat - 2023"
    echo ""
    echo "Usage:"
    echo "  $self [DIR] [NAME]"
    echo ""
    echo "Arguments:"
    echo "  DIR   The directory to create the project in. If not specified, an fzf prompt will be shown."
    echo "  NAME  The name of the project. If not specified, a prompt will be shown."
}

# Show help if --help arg is given
if [[ $1 == "--help" ]]; then
    usage
    exit 0
fi

# Get dir from arg or fzf
if [[ $# -ge 1 ]]; then
    dir=$1
else
    dir=$(find "$PROJECTS_DIR" -mindepth 1 -maxdepth 1 -type d -printf "%f\n" | fzf --reverse --prompt="Where? ")
fi

# Validate dir
if [[ -z $dir ]]; then
    exit 0
fi

# Get name from arg or prompt
if [[ $# -ge 2 ]]; then
    name=$2
else
    echo -n "Name: $dir/"
    read name
fi

# Validate name
if [[ -z $name ]]; then
    exit 0
fi

# Create project and session
mkdir -p "$PROJECTS_DIR/dir/$name"
tps "$PROJECTS_DIR/$dir/$name"
